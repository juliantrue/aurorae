generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// -----------------------------
// RITES AND VERSIONS
// -----------------------------
model Rite {
  id          Int           @id @default(autoincrement())
  name        String        @unique // e.g. "Roman", "Ambrosian"
  description String?
  versions    RiteVersion[]
}

model RiteVersion {
  id          Int       @id @default(autoincrement())
  slug        String    @unique // e.g. "rom1962", "rom1970", "rom2002"
  name        String
  promulgated DateTime? // promulgation date if known
  notes       String?

  riteId Int
  rite   Rite @relation(fields: [riteId], references: [id])

  // Self-relation for inheritance
  parentId Int?
  parent   RiteVersion?  @relation("RiteVersionParent", fields: [parentId], references: [id])
  children RiteVersion[] @relation("RiteVersionParent")

  movableFeasts MovableFeast[]
  fixedFeasts   FixedFeast[]
  seasonalDays  SeasonalDay[]
  Season        Season[]
  Rank          Rank[]
}

// ----------------------------------------------------------
// CALENDAR
// ----------------------------------------------------------
model Season {
  id            Int           @id @default(autoincrement())
  key           String // e.g., "Quadragesimae"
  latinName     String
  vernacular    String? // optional English name
  color         String? // liturgical color (e.g., "violet")
  description   String?
  riteVersionId Int
  riteVersion   RiteVersion   @relation(fields: [riteVersionId], references: [id])
  SeasonalDay   SeasonalDay[]

  @@unique([key, riteVersionId])
}

model Rank {
  id            Int            @id @default(autoincrement())
  key           String // e.g., "sollemnitas", "festum duplex majus"
  latinName     String
  vernacular    String?
  precedence    Int? // numeric hierarchy, e.g., 1=highest
  description   String?
  riteVersionId Int
  riteVersion   RiteVersion    @relation(fields: [riteVersionId], references: [id])
  MovableFeast  MovableFeast[]
  FixedFeast    FixedFeast[]
  SeasonalDay   SeasonalDay[]

  @@unique([key, riteVersionId])
}

model MovableFeast {
  id               Int     @id @default(autoincrement())
  key              String  @unique
  name             String
  offsetFromEaster Int
  description      String?

  riteVersionId Int
  riteVersion   RiteVersion @relation(fields: [riteVersionId], references: [id])
  rankId        Int
  rank          Rank        @relation(fields: [rankId], references: [id])

  @@unique([key, riteVersionId])
}

model FixedFeast {
  id          Int     @id @default(autoincrement())
  key         String  @unique
  name        String
  month       Int
  day         Int
  description String?

  riteVersionId Int
  riteVersion   RiteVersion @relation(fields: [riteVersionId], references: [id])
  rankId        Int
  rank          Rank        @relation(fields: [rankId], references: [id])

  @@unique([key, riteVersionId])
}

model SeasonalDay {
  id          Int            @id @default(autoincrement())
  key         String         @unique
  weekNumber  Int
  weekday     DiesHebdomadis
  description String?

  riteVersionId Int
  riteVersion   RiteVersion @relation(fields: [riteVersionId], references: [id])
  rankId        Int
  rank          Rank        @relation(fields: [rankId], references: [id])
  seasonId      Int
  season        Season      @relation(fields: [seasonId], references: [id])

  @@unique([key, riteVersionId])
}

enum DiesHebdomadis {
  Dominica
  FeriaSecunda
  FeriaTertia
  FeriaQuarta
  FeriaQuinta
  FeriaSexta
  Sabbatum
}
